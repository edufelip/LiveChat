package com.edufelip.livechat.domain.utils

private val REGION_TO_CALLING_CODE: Map<String, String> =
    mapOf(
        "US" to "1",
        "CA" to "1",
        "BR" to "55",
        "AR" to "54",
        "BO" to "591",
        "CL" to "56",
        "CO" to "57",
        "EC" to "593",
        "GY" to "592",
        "PY" to "595",
        "PE" to "51",
        "SR" to "597",
        "UY" to "598",
        "VE" to "58",
        "MX" to "52",
        "GT" to "502",
        "SV" to "503",
        "HN" to "504",
        "NI" to "505",
        "CR" to "506",
        "PA" to "507",
        "DO" to "1",
        "HT" to "509",
        "CU" to "53",
        "PR" to "1",
        "JM" to "1",
        "TT" to "1868",
        "BB" to "1246",
        "AG" to "1268",
        "KN" to "1869",
        "LC" to "1758",
        "VC" to "1784",
        "GD" to "1473",
        "BS" to "1242",
        "AI" to "1264",
        "BM" to "1441",
        "TC" to "1649",
        "VG" to "1284",
        "KY" to "1345",
        "MS" to "1664",
        "BZ" to "501",
        "AU" to "61",
        "NZ" to "64",
        "FJ" to "679",
        "PG" to "675",
        "WS" to "685",
        "TO" to "676",
        "SB" to "677",
        "VU" to "678",
        "NR" to "674",
        "TV" to "688",
        "NC" to "687",
        "PF" to "689",
        "JP" to "81",
        "CN" to "86",
        "HK" to "852",
        "MO" to "853",
        "KR" to "82",
        "KP" to "850",
        "TW" to "886",
        "ID" to "62",
        "MY" to "60",
        "SG" to "65",
        "TH" to "66",
        "VN" to "84",
        "KH" to "855",
        "LA" to "856",
        "PH" to "63",
        "IN" to "91",
        "PK" to "92",
        "BD" to "880",
        "LK" to "94",
        "NP" to "977",
        "BT" to "975",
        "MV" to "960",
        "AF" to "93",
        "IR" to "98",
        "IQ" to "964",
        "SY" to "963",
        "JO" to "962",
        "LB" to "961",
        "SA" to "966",
        "AE" to "971",
        "KW" to "965",
        "QA" to "974",
        "OM" to "968",
        "YE" to "967",
        "IL" to "972",
        "TR" to "90",
        "AZ" to "994",
        "AM" to "374",
        "GE" to "995",
        "RU" to "7",
        "KZ" to "7",
        "UZ" to "998",
        "TM" to "993",
        "TJ" to "992",
        "KG" to "996",
        "MN" to "976",
        "GB" to "44",
        "IE" to "353",
        "FR" to "33",
        "DE" to "49",
        "ES" to "34",
        "PT" to "351",
        "IT" to "39",
        "BE" to "32",
        "NL" to "31",
        "LU" to "352",
        "CH" to "41",
        "AT" to "43",
        "DK" to "45",
        "SE" to "46",
        "NO" to "47",
        "FI" to "358",
        "IS" to "354",
        "GR" to "30",
        "CY" to "357",
        "MT" to "356",
        "CZ" to "420",
        "SK" to "421",
        "PL" to "48",
        "HU" to "36",
        "SI" to "386",
        "HR" to "385",
        "BA" to "387",
        "RS" to "381",
        "ME" to "382",
        "MK" to "389",
        "BG" to "359",
        "RO" to "40",
        "UA" to "380",
        "BY" to "375",
        "EE" to "372",
        "LV" to "371",
        "LT" to "370",
        "MD" to "373",
        "AL" to "355",
        "XK" to "383",
        "DZ" to "213",
        "EG" to "20",
        "MA" to "212",
        "TN" to "216",
        "LY" to "218",
        "SD" to "249",
        "SS" to "211",
        "ET" to "251",
        "SO" to "252",
        "DJ" to "253",
        "KE" to "254",
        "TZ" to "255",
        "UG" to "256",
        "BI" to "257",
        "RW" to "250",
        "MW" to "265",
        "ZM" to "260",
        "ZW" to "263",
        "MZ" to "258",
        "AO" to "244",
        "CD" to "243",
        "CG" to "242",
        "CM" to "237",
        "GA" to "241",
        "GQ" to "240",
        "ST" to "239",
        "BJ" to "229",
        "BF" to "226",
        "CI" to "225",
        "GH" to "233",
        "NG" to "234",
        "SN" to "221",
        "ML" to "223",
        "NE" to "227",
        "TD" to "235",
        "MR" to "222",
        "SL" to "232",
        "LR" to "231",
        "GM" to "220",
        "GW" to "245",
        "CV" to "238",
        "NA" to "264",
        "BW" to "267",
        "LS" to "266",
        "SZ" to "268",
        "ZA" to "27",
        "ER" to "291",
        "PS" to "970",
    )

fun countryCallingCodeFor(regionIso: String?): String? =
    regionIso
        ?.trim()
        ?.takeIf { it.length in 2..3 }
        ?.uppercase()
        ?.let { REGION_TO_CALLING_CODE[it] }

private val CALLING_CODES_DESCENDING: List<String> =
    REGION_TO_CALLING_CODE.values
        .distinct()
        .sortedByDescending { it.length }

fun splitE164PhoneNumber(e164: String): Pair<String, String>? {
    val trimmed = e164.trim()
    if (!trimmed.startsWith("+")) return null
    val digits = trimmed.drop(1).filter(Char::isDigit)
    if (digits.isEmpty()) return null
    val callingCode = CALLING_CODES_DESCENDING.firstOrNull { digits.startsWith(it) } ?: return null
    val nationalNumber = digits.removePrefix(callingCode)
    if (nationalNumber.isEmpty()) return null
    return "+$callingCode" to nationalNumber
}
